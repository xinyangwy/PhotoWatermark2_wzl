# 水印文件本地应用需求文档（PRD）

## 1. 产品概述

### 1.1 产品名称
图片水印工具 (PhotoMark)

### 1.2 产品定位
一款简单易用的本地图片水印处理工具，支持批量为图片添加文本或图片水印，并提供丰富的自定义选项。

### 1.3 目标用户
- 需要为图片添加版权信息的摄影师
- 需要为产品图片添加品牌标识的电商从业者
- 需要为文档图片添加标记的办公人员
- 其他需要批量处理图片水印的普通用户

## 2. 功能需求

### 2.1 文件处理

#### 2.1.1 导入图片
- **单张导入**：支持通过拖拽或文件选择器导入单张图片
- **批量导入**：支持一次性选择多张图片或导入整个文件夹
- **图片列表**：在界面上显示已导入图片的缩略图和文件名

#### 2.1.2 支持格式
- **输入格式**：
  - 必须支持：JPEG, PNG (包括透明通道),BMP, TIFF
- **输出格式**：
  - 用户可选择输出为 JPEG 或 PNG

#### 2.1.3 导出图片
- **输出路径**：
  - 文件夹选择：浏览选择输出目录（默认禁止导出到原文件夹，防止覆盖原图）
  - 路径显示：显示当前选择的输出路径
  - 默认路径：程序安装目录下的output文件夹
- **命名规则**：
  - 保留原文件名
  - 添加自定义前缀（如 wm_）
  - 添加自定义后缀（如 _watermarked）
- **高级选项**：
  - JPEG 质量调节（0-100）
  - PNG格式：保持无损压缩
  - 导出时调整图片尺寸（按宽度、高度或百分比缩放）

### 2.2 水印类型

#### 2.2.1 文本水印
- **内容**：用户可自定义输入任意文本
- **字体设置**：
  - 选择系统已安装的字体
  - 调整字号
  - 设置粗体、斜体
- **颜色**：提供调色板选择字体颜色
- **透明度**：可调节文本透明度（0-100%）
- **样式**：可添加阴影或描边效果

#### 2.2.2 图片水印
- **选择**：用户可从本地选择图片作为水印
- **格式**：支持带透明通道的 PNG 图片
- **缩放**：可按比例或自由调整图片水印大小
- **透明度**：可调节图片水印整体透明度（0-100%）
- **预设样式**：resources/watermarks 文件夹中提供一些预设样式，自动排列展示在应用界面供用户选择

### 2.3 水印布局与样式

#### 2.3.1 实时预览
- 所有水印调整都在主预览窗口实时显示效果
- 用户可点击图片列表切换预览不同图片

#### 2.3.2 位置
- **预设位置**：提供九宫格布局（左上角、左下角、右上角、右下角、正中心），用户可一键将水印放置在这些位置。
- **手动拖拽**：用户可在预览图上通过鼠标拖拽水印到任意位置

#### 2.3.3 旋转
- 提供滑块或输入框，允许用户以任意角度旋转水印

### 2.4 配置管理

#### 2.4.1 水印模板
- 用户可以将当前的水印设置（包括水印内容、字体、颜色、位置、大小、透明度等所有参数）保存为一个模板。
- 用户可以加载、管理和删除已保存的模板。
- 程序启动时可自动加载上一次关闭时的设置或一个默认模板。

## 3. 非功能需求

### 3.1 性能需求
- 应用启动时间不超过3秒
- 图片导入和预览生成时间不超过1秒（对于普通大小图片）
- 批量处理时，每张图片的处理时间不应超过2秒

### 3.2 兼容性需求
- 支持 Windows 10 及以上版本
- 不依赖于特定的第三方软件

### 3.3 用户体验需求
- 界面简洁直观，操作流程清晰
- 提供适当的操作提示和帮助信息
- 支持撤销/重做操作
- 处理大批量图片时显示进度条

### 3.4 安全需求
- 不收集用户个人信息
- 不需要联网权限
- 不修改原始图片文件

## 4. 界面设计

### 4.1 主界面布局
- 左侧：已导入图片列表（缩略图+文件名）
- 中间：当前选中图片的预览区域（带水印效果）
- 右侧：水印设置面板

### 4.2 水印设置面板
水印设置面板是用户进行水印配置的核心区域，包含以下主要功能模块：

#### 4.2.1 水印类型选择
- **文本水印**：适用于添加文字信息，如版权信息、标识等
- **图片水印**：适用于添加Logo、图标等图片形式的水印
- 支持在两种类型间快速切换，切换时保留各自的配置参数

#### 4.2.2 水印内容设置
- **文本水印内容设置**：
  - 文本输入框：支持多行文本输入
  - 字体选择：下拉菜单选择系统可用字体
  - 字号调节：滑块或数值输入（建议范围6-72px）
  - 字体样式：粗体、斜体、下划线、删除线等选项
  - 颜色选择：调色板选择文字颜色
  - 透明度调节：0-100%滑块控制
- **图片水印内容设置**：
  - 图片选择：文件选择器或拖拽导入
  - 预设水印：resources/watermarks文件夹中的预设样式展示
  - 缩放调节：按比例缩放或自定义尺寸
  - 透明度调节：0-100%滑块控制

#### 4.2.3 位置和样式设置
- **预设位置**：九宫格布局快速定位（左上、中上、右上、左中、正中、右中、左下、中下、右下）
- **手动定位**：
  - 拖拽移动：在预览区域直接拖拽水印
  - 坐标输入：精确X、Y坐标数值输入
- **旋转设置**：
  - 角度滑块：0-360度连续调节
  - 数值输入：精确角度输入
  - 快捷角度：0°、45°、90°、180°、270°快速选择
- **层级管理**：
  - 多水印支持：可添加多个水印
  - 层级调整：调整水印的前后顺序

### 4.3 菜单栏
- 文件：导入图片、导入文件夹、导出设置、退出
- 编辑：撤销、重做、清除所有图片
- 模板：保存模板、加载模板、管理模板
- 帮助：使用说明、关于

## 5. 技术实现方案

### 5.1 开发技术
- 使用 Python 作为主要开发语言
- GUI 框架：PyQt6
- 图像处理库：Pillow (PIL Fork)
- 打包工具：PyInstaller

（已经提供venv虚拟环境，已经安装Pyqt6、Pillow等等）

### 5.2 系统架构
- **UI 层**：负责界面展示和用户交互
- **业务逻辑层**：处理水印添加、图片处理等核心功能
- **数据层**：管理模板配置、临时文件等


## 6. 风险评估

### 6.1 潜在风险
- 大尺寸图片处理可能导致性能问题
- 不同格式图片的兼容性问题
- 用户界面复杂度与易用性平衡

### 6.2 应对策略
- 对大图片进行预处理，预览时使用缩略图
- 充分测试各种图片格式
- 进行用户体验测试，优化界面设计

## 7. 附录

### 7.1 术语表
- **水印**：添加到图片上的文本或图像标记
- **透明度**：水印的不透明程度，0%为完全透明，100%为完全不透明
- **模板**：保存的水印配置集合，包括位置、样式等参数

### 7.2 参考资料
- 图像处理库文档
- GUI框架文档
- 用户调研反馈
